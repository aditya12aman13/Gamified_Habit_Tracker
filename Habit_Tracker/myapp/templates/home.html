{% load static %}
{% load habit_extras %}

<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
  <div class="container">
    <h1>Hi, {{ request.user.username }} â€” Your Habits</h1>
    <div class="card mb-4 text-center p-3 bg-dark text-light">
  <h2>ğŸ† Level {{ level }}</h2>
  <h5>Total Points: {{ total_points }}</h5>

  <div class="progress mt-2" style="height: 20px;">
    <div class="progress-bar bg-warning" role="progressbar"
         style="width: {{ progress_to_next }}%;"
         aria-valuenow="{{ progress_to_next }}" aria-valuemin="0" aria-valuemax="100">
      {{ progress_to_next }}%
    </div>
  </div>

<small class="text-light">Next level in {{ next_level_points }} pts</small>


</div>

    <a class="btn btn-primary mb-3" href="{% url 'create_habit' %}">Create Habit</a>

    {% for habit in habits %}
     <div class="card mb-2">
  <div class="card-body">
    <h5>{{ habit.title }}</h5>
    <p class="mb-0">{{ habit.description }}</p>
    <small>Points: {{ habit.points }}</small>
    
    <hr>
    <div class="d-flex justify-content-between text-center">
      {% for day in week_days %}
        {% with habit.entries.all|get_entry_for_date:day as entry %}
          <div style="width: 13%;">
            <small>{{ day|date:"D" }}</small><br>
            {% if entry and entry.done %}
              <span class="badge bg-success">âœ“</span>
            {% else %}
              <span class="badge bg-secondary">âœ—</span>
            {% endif %}
          </div>
        {% endwith %}
      {% endfor %}
    </div>

    <div class="mt-2 text-end">
      <form method="post" action="{% url 'toggle_done' habit.id %}">
        {% csrf_token %}
        {% with habit.entries.all|get_entry_for_date:today as today_entry %}
          {% if today_entry and today_entry.done %}
            <button class="btn btn-success">Done Today âœ“</button>
          {% else %}
            <button class="btn btn-outline-secondary">Mark Done Today</button>
          {% endif %}
        {% endwith %}
      </form>
    </div>
  </div>
</div>

    {% empty %}
      <p>No habits yet â€” create your first one.</p>
    {% endfor %}
  </div>
</body>
</html>
